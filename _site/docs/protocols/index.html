<!DOCTYPE HTML>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <title>Protocol Configuration</title>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="generator" content="Jekyll v3.5.2">
  <link rel="alternate" type="application/rss+xml" title="Ball Aerospace COSMOS News" href="/feed.xml">
  <link rel="alternate" type="application/atom+xml" title="Recent commits to COSMOS's master branch" href="https://github.com/BallAerospace/COSMOS/commits/master.atom">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic,900">
  <link rel="stylesheet" href="/css/screen.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!--[if lt IE 9]>
  <script src="/js/html5shiv.min.js"></script>
  <script src="/js/respond.min.js"></script>
  <![endif]-->
</head>


<body class="wrap">
  <header role="banner">
  <nav class="mobile-nav show-on-mobiles">
    <ul>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="current">
    <span class="hide-on-mobiles"><a href="/docs/home/">Documentation</a></span>
    <span class="show-on-mobiles"><a href="/docs/home/">Docs</a></span>
  </li>
  <li class="">
    <a href="/news/">News</a>
  </li>
  <li>
    <a href="/help/">Help</a>
  </li>
  <li>
    <a href="https://github.com/BallAerospace/COSMOS" target="_blank"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

  </nav>
  <div class="grid wider">
    <div class="unit one-third center-on-mobiles" style="margin-top:27px;">
      <h1>
        <a href="/">
          <span class="sr-only">COSMOS</span>
          <img src="/img/COSMOS.png" width="312" height="70" alt="COSMOS Logo">
        </a>
      </h1>
    </div>
    <nav class="main-nav unit two-thirds hide-on-mobiles">
      <ul>
  <li class="">
    <a href="/">Home</a>
  </li>
  <li class="current">
    <span class="hide-on-mobiles"><a href="/docs/home/">Documentation</a></span>
    <span class="show-on-mobiles"><a href="/docs/home/">Docs</a></span>
  </li>
  <li class="">
    <a href="/news/">News</a>
  </li>
  <li>
    <a href="/help/">Help</a>
  </li>
  <li>
    <a href="https://github.com/BallAerospace/COSMOS" target="_blank"><span class="hide-on-mobiles">View on </span>GitHub</a>
  </li>
</ul>

    </nav>
  </div>
</header>


    <section class="docs">
    <div class="grid wider">

      <div class="docs-nav-mobile unit whole show-on-mobiles">
  <select onchange="if (this.value) window.location.href=this.value">
    <option value="">Navigate the docs...</option>
    
    <optgroup label="Getting Started">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/home/">Welcome</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/installation/">Installation</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/upgrading/">Upgrading and the Gemfile</option>
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/structure/">Directory structure</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/gettingstarted/">Getting Started</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="System Configuration">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/system/">System Configuration</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
      <option value="/docs/command/">Command Configuration</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/telemetry/">Telemetry Configuration</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/interfaces/">Interface Configuration</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/protocols/">Protocol Configuration</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/environment/">Environment Variables</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="Tool Configuration">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/launcher/">Launcher</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
      <option value="/docs/data_viewer/">Data Viewer</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/handbook_creator/">Handbook Creator</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/limits_monitor/">Limits Monitor</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/script_runner/">Script Runner</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/table_manager/">Table Manager</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/test_runner/">Test Runner</option>
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/tlm_extractor/">Telemetry Extractor</option>
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/tlm_viewer/">Telemetry Viewer</option>
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/screens/">Telemetry Screens</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="User's Guides">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/scripting/">Scripting Guide</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/gemtargets/">Gem Based Targets and Tools</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="Tips">
      


  

  
    
      <option value="/docs/chaining/">Chaining CmdTlmServers</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="Development">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/system_class/">System Class</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/packet_class/">Packet Class</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/json_api/">JSON API</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
    <optgroup label="Meta">
      


  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/requirements/">Requirements and Design</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/xtce/">XTCE Support</option>
    
  

  

  
    
  
    
  
    
  
    
      <option value="/docs/contributing/">Contributing</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
      <option value="/docs/contact/">Contact Us</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/history/">Release History</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <option value="/docs/papers/">Papers</option>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  


    </optgroup>
    
  </select>
</div>


      <div class="unit four-fifths">
        <article>
          <div class="improve right">
            <a href="https://github.com/BallAerospace/COSMOS/edit/website/_docs/protocols.md" target="_blank"><i class="fa fa-pencil"></i> &nbsp;Improve this page</a>
          </div>
          
          <div class="toc">
            <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#packet-delineation-protocols">Packet Delineation Protocols</a>
<ul>
<li class="toc-entry toc-h3"><a href="#burst-protocol">Burst Protocol</a></li>
<li class="toc-entry toc-h3"><a href="#fixed-protocol">Fixed Protocol</a></li>
<li class="toc-entry toc-h3"><a href="#length-protocol">Length Protocol</a></li>
<li class="toc-entry toc-h3"><a href="#terminated-protocol">Terminated Protocol</a></li>
<li class="toc-entry toc-h3"><a href="#template-protocol">Template Protocol</a></li>
<li class="toc-entry toc-h3"><a href="#preidentified-protocol">Preidentified Protocol</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#helper-protocols">Helper Protocols</a>
<ul>
<li class="toc-entry toc-h3"><a href="#override-protocol">Override Protocol</a></li>
<li class="toc-entry toc-h3"><a href="#crc-protocol">CRC Protocol</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#custom-protocols">Custom Protocols</a></li>
<li class="toc-entry toc-h2"><a href="#method-discussions">Method discussions</a>
<ul>
<li class="toc-entry toc-h3"><a href="#initialize">initialize</a></li>
<li class="toc-entry toc-h3"><a href="#reset">reset</a></li>
<li class="toc-entry toc-h3"><a href="#connect_reset">connect_reset</a></li>
<li class="toc-entry toc-h3"><a href="#disconnect_reset">disconnect_reset</a></li>
<li class="toc-entry toc-h3"><a href="#read_data">read_data</a></li>
<li class="toc-entry toc-h3"><a href="#read_packet">read_packet</a></li>
<li class="toc-entry toc-h3"><a href="#write_packet">write_packet</a></li>
<li class="toc-entry toc-h3"><a href="#write_data">write_data</a></li>
<li class="toc-entry toc-h3"><a href="#post_write_interface">post_write_interface</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#examples">Examples</a></li>
</ul>
          </div>
          
          <h1>Protocol Configuration</h1>
          <p>Protocols process data on behalf of an Interface. They can modify the data being written, data being read, or both. Protocols can be layered and will be processed in order. For example, if you have a low-level encryption layer that must be first removed before processing a higher level buffer length protocol.</p>

<p>Protocols are typically used to define the logic to delineate packets and manipulate data as it written to and read from Interfaces. COSMOS includes Interfaces for TCP/IP Client, TCP/IP Server, Udp Client / Server, and Serial connections. For 99% of use cases these Interfaces should not require any changes as they universally handle the low-level details of reading and writing from these types of connections. All unique behavior should now be defined in Protocols as of COSMOS 4.0.0. (Note in versions of COSMOS before COSMOS 4, Interfaces supported a more limited system called Stream Protocols. Interfaces only allowed one Stream Protocol and were highly coupled. This document refers to protocols in COSMOS 4+.)</p>

<p>At a minimum, any byte stream based Interface will require a Protocol to delineate packets. TCP/IP and Serial are examples of byte stream based Interfaces. A byte stream is just a simple stream of bytes and thus you need some way to know where packets begin and end within the stream.</p>

<p>TCP/IP is a friendly byte stream. Unless you are dealing with a very poorly written system, the first byte received on a TCP/IP connection will always be the start of a packet. Also, TCP/IP is a reliable connection in that it ensures that all data is received in the correct order, that no data is lost, and that the data is not corrupted (TCP/IP is protected by a CRC32 which is pretty good for avoiding unrecognized data corruption).</p>

<p>Serial is a much less friendly byte stream. With serial connections, it is very likely that when you open a serial port and start receiving data you will receive the middle of a message. (This problem is only avoided when interfacing with a system that only writes to the serial port in response to a command). For this reason, sync patterns are highly beneficial for serial interfaces. Additionally, serial interfaces may use some method to protect against unrecognized data corruption (Checksums, CRCs, etc.)</p>

<p>UDP is an inherently packet based connection. If you read from a UDP socket, you will always receive back an entire packet. The best UDP based Protocols take advantage of this fact. Some implementations try to make UDP act like a byte stream, but this is a misuse of the protocol because it is highly likely that you will lose data and have no way to recover.</p>

<h2 id="packet-delineation-protocols">
<a id="packet-delineation-protocols" class="anchor" href="#packet-delineation-protocols" aria-hidden="true"><span class="octicon octicon-link"></span></a>Packet Delineation Protocols</h2>
<p>COSMOS provides the following packet delineation protocols: Burst, Fixed, Length, Preidentified, Template, and Terminated. Each of these protocols has the primary purpose of separating out packets from a byte stream.</p>

<h3 id="burst-protocol">
<a id="burst-protocol" class="anchor" href="#burst-protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>Burst Protocol</h3>
<p>The Burst Protocol simply reads as much data as it can from the interface before returning the data as a COSMOS Packet (It returns a packet for each burst of data read). This Protocol relies on regular bursts of data delimited by time and thus is not very robust. However, it can utilize a sync pattern which does allow it to re-sync if necessary. It can also discard bytes from the incoming data to remove the sync pattern. Finally, it can add sync patterns to data being written out of the Interface.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Discard Leading Bytes</td>
      <td>The number of bytes to discard from the binary data after reading. Note that this applies to bytes starting with the sync pattern if the sync pattern is being used.</td>
      <td>No</td>
      <td>0 (do not discard bytes)</td>
    </tr>
    <tr>
      <td>Sync Pattern</td>
      <td>Hex string representing a byte pattern that will be searched for in the raw data. This pattern represents a packet delimiter and all data found including the sync pattern will be returned</td>
      <td>No</td>
      <td>nil (no sync pattern)</td>
    </tr>
    <tr>
      <td>Fill Fields</td>
      <td>Whether to fill in the sync pattern on outgoing packets</td>
      <td>No</td>
      <td>false</td>
    </tr>
    <tr>
      <td>Allow Empty Data</td>
      <td>Whether this protocol will allow an empty string to be passed down to later Protocols (instead of returning :STOP). Can be true, false, or nil, where nil is interpreted as true unless the Protocol is the last Protocol of the chain. (As of COSMOS 4.1.1)</td>
      <td>No</td>
      <td>nil</td>
    </tr>
  </tbody>
</table>

<h3 id="fixed-protocol">
<a id="fixed-protocol" class="anchor" href="#fixed-protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fixed Protocol</h3>
<p>The Fixed Protocol reads a preset minimum amount of data which is necessary to properly identify all the defined packets using the interface. It then identifies the packet and proceeds to read as much data from the interface as necessary to create the packet which it then returns. This protocol relies on all the packets on the interface being fixed in length. For example, all the packets using the interface are a fixed size and contain a simple header with a 32-bit sync pattern followed by a 16 bit ID. The Fixed Protocol would elegantly handle this case with a minimum read size of 6 bytes. The Fixed Protocol also supports a sync pattern, discarding leading bytes, and filling the sync pattern similar to the Burst Protocol.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Minimum ID Size</td>
      <td>The minimum number of bytes needed to identify a packet. All the packet definitions must declare their ID_ITEM(s) within this given number of bytes.</td>
      <td>Yes</td>
      <td> </td>
    </tr>
    <tr>
      <td>Discard Leading Bytes</td>
      <td>The number of bytes to discard from the binary data after reading. Note that this applies to bytes starting with the sync pattern if the sync pattern is being used.</td>
      <td>No</td>
      <td>0 (do not discard bytes)</td>
    </tr>
    <tr>
      <td>Sync Pattern</td>
      <td>Hex string representing a byte pattern that will be searched for in the raw data. This pattern represents a packet delimiter and all data found including the sync pattern will be returned.</td>
      <td>No</td>
      <td>nil (no sync pattern)</td>
    </tr>
    <tr>
      <td>Telemetry</td>
      <td>Whether the data is telemetry</td>
      <td>No</td>
      <td>true (false means command)</td>
    </tr>
    <tr>
      <td>Fill Fields</td>
      <td>Whether to fill in the sync pattern on outgoing packets</td>
      <td>No</td>
      <td>false</td>
    </tr>
    <tr>
      <td>Unknown Raise</td>
      <td>Whether to raise an exception for an unknown packet</td>
      <td>No</td>
      <td>false</td>
    </tr>
    <tr>
      <td>Allow Empty Data</td>
      <td>Whether this protocol will allow an empty string to be passed down to later Protocols (instead of returning :STOP). Can be true, false, or nil, where nil is interpreted as true unless the Protocol is the last Protocol of the chain. (As of COSMOS 4.1.1)</td>
      <td>No</td>
      <td>nil</td>
    </tr>
  </tbody>
</table>

<h3 id="length-protocol">
<a id="length-protocol" class="anchor" href="#length-protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>Length Protocol</h3>
<p>The Length Protocol depends on a length field at a fixed location in the defined packets using the interface. It then reads enough data to grab the length field, decodes it, and reads the remaining length of the packet. For example, all the packets using the interface contain a CCSDS header with a length field. The Length Protocol can be set up to handle the length field and even the length offset CCSDS uses. The Length Protocol also supports a sync pattern, discarding leading bytes, and filling the length and sync pattern similar to the Burst Protocol.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Length Bit Offset</td>
      <td>The bit offset from the start of the packet to the length field. Every packet using this interface must have the same structure such that the length field is the same size at the same location. Be sure to account for the length of the Sync Pattern in this value (if present).</td>
      <td>No</td>
      <td>0 bits</td>
    </tr>
    <tr>
      <td>Length Bit Size</td>
      <td>The size in bits of the length field</td>
      <td>No</td>
      <td>16 bits</td>
    </tr>
    <tr>
      <td>Length Value Offset</td>
      <td>The offset to apply to the length field value. The actual value of the length field plus this offset should equal the exact number of bytes required to read all data for the packet (including the length field itself, sync pattern, etc). For example, if the length field indicates packet length minus one, this value should be one. Be sure to account for the length of the Sync Pattern in this value (if present).</td>
      <td>No</td>
      <td>0</td>
    </tr>
    <tr>
      <td>Bytes per Count</td>
      <td>The number of bytes per each length field ‘count’. This is used if the units of the length field is something other than bytes, e.g. if the length field count is in words.</td>
      <td>No</td>
      <td>1 byte</td>
    </tr>
    <tr>
      <td>Length Endianness</td>
      <td>The endianness of the length field. Must be either ‘BIG_ENDIAN’ or ‘LITTLE_ENDIAN’.</td>
      <td>No</td>
      <td>‘BIG_ENDIAN’</td>
    </tr>
    <tr>
      <td>Discard Leading Bytes</td>
      <td>The number of bytes to discard from the binary data after reading. Note that this applies to bytes including the sync pattern if the sync pattern is being used. Discarding is one of the very last steps so any size and offsets above need to account for all the data before discarding.</td>
      <td>No</td>
      <td>0 (do not discard bytes)</td>
    </tr>
    <tr>
      <td>Sync Pattern</td>
      <td>Hex string representing a byte pattern that will be searched for in the raw data. This pattern represents a packet delimiter and all data found including the sync pattern will be returned.</td>
      <td>No</td>
      <td>nil (no sync pattern)</td>
    </tr>
    <tr>
      <td>Max Length</td>
      <td>The maximum allowed value in the length field</td>
      <td>No</td>
      <td>nil (no maximum length)</td>
    </tr>
    <tr>
      <td>Fill Length and Sync Pattern</td>
      <td>Setting this flag to true causes the length field and sync pattern (if present) to be filled automatically on outgoing packets.</td>
      <td>No</td>
      <td>false</td>
    </tr>
    <tr>
      <td>Allow Empty Data</td>
      <td>Whether this protocol will allow an empty string to be passed down to later Protocols (instead of returning :STOP). Can be true, false, or nil, where nil is interpreted as true unless the Protocol is the last Protocol of the chain. (As of COSMOS 4.1.1)</td>
      <td>No</td>
      <td>nil</td>
    </tr>
  </tbody>
</table>

<h3 id="terminated-protocol">
<a id="terminated-protocol" class="anchor" href="#terminated-protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>Terminated Protocol</h3>
<p>The Terminated Protocol delineates packets using termination characters found at the end of every packet. It continuously reads data until the termination characters are found at which point it returns the packet data. For example, all the packets using the interface are followed by 0xABCD. This data can either be a part of each packet that is kept or something which is known only by the Terminated Protocol and simply thrown away.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Write Termination Characters</td>
      <td>The data to write after writing a command packet. Given as a hex string such as 0xABCD.</td>
      <td>Yes</td>
      <td> </td>
    </tr>
    <tr>
      <td>Read Termination Characters</td>
      <td>The characters which delineate the end of a telemetry packet. Given as a hex string such as 0xABCD.</td>
      <td>Yes</td>
      <td> </td>
    </tr>
    <tr>
      <td>Strip Read Termination</td>
      <td>Whether to remove the read termination characters before returning the telemetry packet</td>
      <td>No</td>
      <td>true</td>
    </tr>
    <tr>
      <td>Discard Leading Bytes</td>
      <td>The number of bytes to discard from the binary data after reading. Note that this applies to bytes including the sync pattern if the sync pattern is being used.</td>
      <td>No</td>
      <td>0 (do not discard bytes)</td>
    </tr>
    <tr>
      <td>Sync Pattern</td>
      <td>Hex string representing a byte pattern that will be searched for in the raw data. This pattern represents a packet delimiter and all data found including the sync pattern will be returned.</td>
      <td>No</td>
      <td>nil (no sync pattern)</td>
    </tr>
    <tr>
      <td>Fill Fields</td>
      <td>Whether to fill in the sync pattern on outgoing packets</td>
      <td>No</td>
      <td>false</td>
    </tr>
    <tr>
      <td>Allow Empty Data</td>
      <td>Whether this protocol will allow an empty string to be passed down to later Protocols (instead of returning :STOP). Can be true, false, or nil, where nil is interpreted as true unless the Protocol is the last Protocol of the chain. (As of COSMOS 4.1.1)</td>
      <td>No</td>
      <td>nil</td>
    </tr>
  </tbody>
</table>

<h3 id="template-protocol">
<a id="template-protocol" class="anchor" href="#template-protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>Template Protocol</h3>

<p>The Template Protocol works much like the Terminated Protocol except it is designed for text-based command and response type interfaces such as SCPI (Standard Commands for Programmable Instruments). It delineates packets in the same way as the Terminated Protocol except each packet is referred to as a line (because each usually contains a line of text). For outgoing packets, a CMD_TEMPLATE field is expected to exist in the packet. This field contains a template string with items to be filled in delineated within HTML tag style brackets <code class="highlighter-rouge">"&lt;EXAMPLE&gt;"</code>. The Template Protocol will read the named items from within the packet and fill in the CMD_TEMPLATE. This filled in string is then sent out rather than the originally passed in packet. Correspondingly, if a response is expected the outgoing packet should include a RSP_TEMPLATE and RSP_PACKET field. The RSP_TEMPLATE is used to extract data from the response string and build a corresponding RSP_PACKET. See the TEMPLATE target within the COSMOS Demo configuration for an example of usage.</p>

<p>Check out this <a href="/news/2017/06/19/template_protocol">Template Protocol</a> blog post for additional tips.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Write Termination Characters</td>
      <td>The data to write after writing a command packet. Given as a hex string such as 0xABCD.</td>
      <td>Yes</td>
      <td> </td>
    </tr>
    <tr>
      <td>Read Termination Characters</td>
      <td>The characters which delineate the end of a telemetry packet. Given as a hex string such as 0xABCD.</td>
      <td>Yes</td>
      <td> </td>
    </tr>
    <tr>
      <td>Ignore Lines</td>
      <td>Number of response lines to ignore (completely drop)</td>
      <td>No</td>
      <td>0 lines</td>
    </tr>
    <tr>
      <td>Initial Read Delay</td>
      <td>An initial delay after connecting after which the interface will be read till empty and data dropped. Useful for discarding connect headers and initial prompts.</td>
      <td>No</td>
      <td>nil (no initial read)</td>
    </tr>
    <tr>
      <td>Response Lines</td>
      <td>The number of lines that make up expected responses</td>
      <td>No</td>
      <td>1 line</td>
    </tr>
    <tr>
      <td>Strip Read Termination</td>
      <td>Whether to remove the read termination characters before returning the telemetry packet</td>
      <td>No</td>
      <td>true</td>
    </tr>
    <tr>
      <td>Discard Leading Bytes</td>
      <td>The number of bytes to discard from the binary data after reading. Note that this applies to bytes including the sync pattern if the sync pattern is being used.</td>
      <td>No</td>
      <td>0 (do not discard bytes)</td>
    </tr>
    <tr>
      <td>Sync Pattern</td>
      <td>Hex string representing a byte pattern that will be searched for in the raw data. This pattern represents a packet delimiter and all data found including the sync pattern will be returned.</td>
      <td>No</td>
      <td>nil (no sync pattern)</td>
    </tr>
    <tr>
      <td>Fill Fields</td>
      <td>Whether to fill in the sync pattern on outgoing packets</td>
      <td>No</td>
      <td>false</td>
    </tr>
    <tr>
      <td>Response Timeout</td>
      <td>Number of seconds to wait for a response before timing out</td>
      <td>No</td>
      <td>5.0</td>
    </tr>
    <tr>
      <td>Response Polling Period</td>
      <td>Number of seconds to wait between polling for a response</td>
      <td>No</td>
      <td>0.02</td>
    </tr>
    <tr>
      <td>Raise Exceptions</td>
      <td>Whether to raise exceptions when errors occur like timeouts or unexpected responses</td>
      <td>No</td>
      <td>false</td>
    </tr>
    <tr>
      <td>Allow Empty Data</td>
      <td>Whether this protocol will allow an empty string to be passed down to later Protocols (instead of returning :STOP). Can be true, false, or nil, where nil is interpreted as true unless the Protocol is the last Protocol of the chain. (As of COSMOS 4.1.1)</td>
      <td>No</td>
      <td>nil</td>
    </tr>
  </tbody>
</table>

<h3 id="preidentified-protocol">
<a id="preidentified-protocol" class="anchor" href="#preidentified-protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>Preidentified Protocol</h3>
<p>The Preidentified Protocol is used internally by the COSMOS Command and Telemetry Server only and delineates packets using a custom COSMOS header. This Protocol is configured by default on port 7779 and is created by the Command and Telemetry Server to allow tools to connect and receive the entire packet stream. The Telemetry Grapher uses this port to receive all the packets following through the Command and Telemetry Server in case any need to be graphed.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Sync Pattern</td>
      <td>Hex string representing a byte pattern that will be searched for in the raw data. This pattern represents a packet delimiter and all data found AFTER the sync pattern will be returned. The sync pattern itself is discarded.</td>
      <td>No</td>
      <td>nil (no sync pattern)</td>
    </tr>
    <tr>
      <td>Max Length</td>
      <td>The maximum allowed value in the length field</td>
      <td>No</td>
      <td>nil (no maximum length)</td>
    </tr>
    <tr>
      <td>Allow Empty Data</td>
      <td>Whether this protocol will allow an empty string to be passed down to later Protocols (instead of returning :STOP). Can be true, false, or nil, where nil is interpreted as true unless the Protocol is the last Protocol of the chain. (As of COSMOS 4.1.1)</td>
      <td>No</td>
      <td>nil</td>
    </tr>
  </tbody>
</table>

<h2 id="helper-protocols">
<a id="helper-protocols" class="anchor" href="#helper-protocols" aria-hidden="true"><span class="octicon octicon-link"></span></a>Helper Protocols</h2>
<p>COSMOS provides the following helper protocols: Override, and Crc. These protocols provide helper functionality to Interfaces.</p>

<h3 id="override-protocol">
<a id="override-protocol" class="anchor" href="#override-protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>Override Protocol</h3>
<p>The Override Protocol allows telemetry items to be overridden when read. This action is permanent and any incoming data is overwritten with the new value. This is in contrast to using the set_tlm() API method which temporarily sets a telemetry value until new data arrives over the interface.</p>

<p>To use this protocol, you must add it to your interface wherever that is defined. Typically, this is in the target’s cmd_tlm_server.txt file but it could also be in the global cmd_tlm_server.txt. For example:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">INTERFACE INST_INT simulated_target_interface.rb sim_inst.rb
 TARGET INST
 PROTOCOL READ OverrideProtocol</code></pre></figure>

<p>By adding this to your interface you now have access to the following APIs:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># Permanently set the converted value of a telemetry point to a given value</span>
<span class="n">override_tlm</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="n">packet_name</span><span class="p">,</span> <span class="n">item_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="c1"># or</span>
<span class="n">override_tlm</span><span class="p">(</span><span class="s2">"target_name packet_name item_name = value"</span><span class="p">)</span>

<span class="c1"># Permanently set the raw value of a telemetry point to a given value</span>
<span class="n">override_tlm_raw</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="n">packet_name</span><span class="p">,</span> <span class="n">item_name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="c1"># or</span>
<span class="n">override_tlm_raw</span><span class="p">(</span><span class="s2">"target_name packet_name item_name = value"</span><span class="p">)</span>

<span class="c1"># Clear an override of a telemetry point</span>
<span class="n">normalize_tlm</span><span class="p">(</span><span class="n">target_name</span><span class="p">,</span> <span class="n">packet_name</span><span class="p">,</span> <span class="n">item_name</span><span class="p">)</span>
<span class="c1"># or</span>
<span class="n">normalize_tlm</span><span class="p">(</span><span class="s2">"target_name packet_name item_name"</span><span class="p">)</span></code></pre></figure>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Allow Empty Data</td>
      <td>Whether this protocol will allow an empty string to be passed down to later Protocols (instead of returning :STOP). Can be true, false, or nil, where nil is interpreted as true unless the Protocol is the last Protocol of the chain. (As of COSMOS 4.1.1)</td>
      <td>No</td>
      <td>nil</td>
    </tr>
  </tbody>
</table>

<h3 id="crc-protocol">
<a id="crc-protocol" class="anchor" href="#crc-protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>CRC Protocol</h3>
<p>The CRC protocol can add CRCs to outgoing commands and verify CRCs on incoming telemetry packets.</p>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
      <th>Required</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Write Item Name</td>
      <td>Item to fill with calculated CRC value for outgoing packets (nil = don’t fill)</td>
      <td>No</td>
      <td>nil</td>
    </tr>
    <tr>
      <td>Strip CRC</td>
      <td>Whether to remove the CRC from incoming packets</td>
      <td>No</td>
      <td>false</td>
    </tr>
    <tr>
      <td>Bad Strategy</td>
      <td>How to handle CRC errors on incoming packets. ERROR = Just log the error, DISCONNECT = Disconnect interface</td>
      <td>No</td>
      <td>“ERROR”</td>
    </tr>
    <tr>
      <td>Bit Offset</td>
      <td>Bit offset of the CRC in the data. Can be negative to indicate distance from end of packet</td>
      <td>No</td>
      <td>-32</td>
    </tr>
    <tr>
      <td>Bit Size</td>
      <td>Bit size of the CRC - Must be 16, 32, or 64</td>
      <td>No</td>
      <td>32</td>
    </tr>
    <tr>
      <td>Endianness</td>
      <td>Endianness of the CRC (BIG_ENDIAN/LITTLE_ENDIAN)</td>
      <td>No</td>
      <td>“BIG_ENDIAN”</td>
    </tr>
    <tr>
      <td>Poly</td>
      <td>Polynomial to use when calculating the CRC expressed as an integer</td>
      <td>No</td>
      <td>nil (use default polynomial - 16-bit=0x1021, 32-bit=0x04C11DB7, 64-bit=0x42F0E1EBA9EA3693)</td>
    </tr>
    <tr>
      <td>Seed</td>
      <td>Seed value to start the calculation</td>
      <td>No</td>
      <td>nil (use default seed - 16-bit=0xFFFF, 32-bit=0xFFFFFFFF, 64-bit=0xFFFFFFFFFFFFFFFF)</td>
    </tr>
    <tr>
      <td>Xor</td>
      <td>Whether to XOR the CRC result with 0xFFFF</td>
      <td>No</td>
      <td>nil (use default value - 16-bit=false, 32-bit=true, 64-bit=true)</td>
    </tr>
    <tr>
      <td>Reflect</td>
      <td>Whether to bit reverse each byte of data before calculating the CRC</td>
      <td>No</td>
      <td>nil (use default value - 16-bit=false, 32-bit=true, 64-bit=true)</td>
    </tr>
    <tr>
      <td>Allow Empty Data</td>
      <td>Whether this protocol will allow an empty string to be passed down to later Protocols (instead of returning :STOP). Can be true, false, or nil, where nil is interpreted as true unless the Protocol is the last Protocol of the chain. (As of COSMOS 4.1.1)</td>
      <td>No</td>
      <td>nil</td>
    </tr>
  </tbody>
</table>

<h2 id="custom-protocols">
<a id="custom-protocols" class="anchor" href="#custom-protocols" aria-hidden="true"><span class="octicon octicon-link"></span></a>Custom Protocols</h2>
<p>Creating a custom protocol is easy and should be the default solution for customizing COSMOS Interfaces (rather than creating a new Interface class). However, creating custom Interfaces is still useful for defaulting parameters to values that always are fixed for your target and for including the necessary Protocols. The base COSMOS Interfaces take a lot of parameters that can be confusing to your end users. Thus you may want to create a custom Interface just to hard coded these values and cut the available parameters down to something like the hostname and port to connect to.</p>

<p>All custom Protocols should derive from the Protocol class found in the COSMOS gem at <a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/protocol.rb">lib/cosmos/interfaces/protocols/protocol.rb</a>. This class defines the 9 methods that are relevant to writing your own protocol. The base class implementation for each method is included below as well as a discussion as to how the methods should be overridden and used in your own Protocols.</p>

<p>To really understand how Protocols work, you first must understand the logic within the base Interface class read and write methods.</p>

<p>Let’s first discuss the read method.</p>

<p><img src="/img/interface_read_logic.png" alt="Interface Read Logic"></p>

<p>On EVERY call to read, an empty Ruby string “” is first passed down to each of the read Protocol’s read_data() method BEFORE new raw data is attempted to be read using the Interface’s read_interface() method. This is a signal to Protocols that have cached up more than one packet worth of data to output those cached packets before any new data is read from the Interface. Typically no data will be cached up and one of the Protocols read_data() methods will return :STOP in response to the empty string, indicating that more data is required to generate a packet. Each Protocol’s read_data() method can return one of three things: data that will be passed down to any additional Protocols or turned into a Packet, :STOP which means more data is required from the Interface for the Protocol to continue, or :DISCONNECT which means that something has happened that requires disconnecting the Interface (and by default trying to reconnect). Each Protocol’s read_data method is passed the data that will eventually be turned into a packet and returns a possibly modified set of data. If the data passes through all Protocol’s read_data() methods it is then converted into a COSMOS packet using the Interface’s convert_data_to_packet() method. This packet is then run in a similar fashion through each Read Protocol’s read_packet() method. This method has essentially the same return possibilities: a Packet (instead of data as in read_data()), :STOP, or :DISCONNECT. If the Packet makes it through all read_packet() methods then the Interface packet read counter is incremented and the Packet is returned to the Interface.</p>

<p><img src="/img/interface_write_logic.png" alt="Interface Write Logic"></p>

<p>The Interface write() method works very similarly to read. (It should be mentioned that by default write protocols run in the reverse order of read protocols. This makes sense because when reading you’re typically stripping layers of data and when writing you’re typically adding on layers in reverse order.)</p>

<p>First, the packet write counter is incremented. Then each write Protocol is given a chance to modify the packet by its write_packet() method being called. This method can either return a potentially modified packet, :STOP, or :DISCONNECT. If a write Protocol returns :STOP no data will be written out the Interface and it is assumed that more packets are necessary before a final packet can be output. :DISCONNECT will disconnect the Interface. If the packet makes it through all the write Protocol’s write_packet() methods, then it is converted to binary data using the Interface’s convert_packet_to_data() method. Next the write_data() method is called for each write Protocol giving it a chance to modify the lower level data. The same return options are available except a Ruby string of data is returned instead of a COSMOS packet. If the data makes it through all write_data() methods, then it is written out on the Interface using the write_interface() method. Afterwards, each Protocol’s post_write_interface() method is called with both the final modified Packet, and the actual data written out to the Interface. This method allows follow-up such as waiting for a response after writing out a message.</p>

<h2 id="method-discussions">
<a id="method-discussions" class="anchor" href="#method-discussions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Method discussions</h2>

<h3 id="initialize">
<a id="initialize" class="anchor" href="#initialize" aria-hidden="true"><span class="octicon octicon-link"></span></a>initialize</h3>

<p>This is the constructor for your custom Protocol. It should always call super(allow_empty_data) to initialize the base Protocol class.</p>

<p>Base class implementation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># @param allow_empty_data [true/false] Whether STOP should be returned on empty data</span>
<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">allow_empty_data</span> <span class="o">=</span> <span class="kp">false</span><span class="p">)</span>
  <span class="vi">@interface</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="vi">@allow_empty_data</span> <span class="o">=</span> <span class="no">ConfigParser</span><span class="p">.</span><span class="nf">handle_true_false</span><span class="p">(</span><span class="n">allow_empty_data</span><span class="p">)</span>
  <span class="n">reset</span><span class="p">()</span>
<span class="k">end</span></code></pre></figure>

<p>As you can see, every Protocol maintains state on at least two items. @interface holds the Interface class instance that the protocol is associated with. This is sometimes necessary to introspect details that only the Interface knows. @allow_empty_data is a flag used by the read_data(data) method that is discussed later in this document.</p>

<h3 id="reset">
<a id="reset" class="anchor" href="#reset" aria-hidden="true"><span class="octicon octicon-link"></span></a>reset</h3>

<p>The reset method is used to reset internal protocol state when the Interface is connected and/or disconnected. This method should be used for common resetting logic. Connect and Disconnect specific logic are handled in the next two methods.</p>

<p>Base class implementation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">reset</span>
<span class="k">end</span></code></pre></figure>

<p>As you can see, the base class reset implementation doesn’t do anything.</p>

<h3 id="connect_reset">
<a id="connect_reset" class="anchor" href="#connect_reset" aria-hidden="true"><span class="octicon octicon-link"></span></a>connect_reset</h3>

<p>The connect_reset method is used to reset internal Protocol state each time the Interface is connected.</p>

<p>Base class implementation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">connect_reset</span>
  <span class="n">reset</span><span class="p">()</span>
<span class="k">end</span></code></pre></figure>

<p>The base class connect_reset implementation just calls the reset method to ensure common reset logic is run.</p>

<h3 id="disconnect_reset">
<a id="disconnect_reset" class="anchor" href="#disconnect_reset" aria-hidden="true"><span class="octicon octicon-link"></span></a>disconnect_reset</h3>

<p>The disconnect_reset method is used to reset internal Protocol state each time the Interface is disconnected.</p>

<p>Base class implementation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">disconnect_reset</span>
  <span class="n">reset</span><span class="p">()</span>
<span class="k">end</span></code></pre></figure>

<p>The base class disconnect_reset implementation just calls the reset method to ensure common reset logic is run.</p>

<h3 id="read_data">
<a id="read_data" class="anchor" href="#read_data" aria-hidden="true"><span class="octicon octicon-link"></span></a>read_data</h3>

<p>The read_data method is used to analyze and potentially modify any raw data read by an Interface. It takes one parameter as the current state of the data to be analyzed. It can return either a Ruby string of data, :STOP, or :DISCONNECT. If it returns a Ruby string, then it believes that data may be ready to be a full packet, and is ready for processing by any following Protocols. If :STOP is returned then the Protocol believes it needs more data to complete a full packet. If :DISCONNECT is returned then the Protocol believes the Interface should be disconnected (and typically automatically reconnected).</p>

<p>Base Class Implemenation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="nf">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@allow_empty_data</span><span class="p">.</span><span class="nf">nil?</span>
      <span class="k">if</span> <span class="vi">@interface</span> <span class="n">and</span> <span class="vi">@interface</span><span class="p">.</span><span class="nf">read_protocols</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="nb">self</span>
        <span class="c1"># Last read interface in chain with auto @allow_empty_data</span>
        <span class="k">return</span> <span class="ss">:STOP</span>
      <span class="k">end</span>
    <span class="k">elsif</span> <span class="o">!</span><span class="vi">@allow_empty_data</span>
      <span class="c1"># Don't @allow_empty_data means STOP</span>
      <span class="k">return</span> <span class="ss">:STOP</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">data</span>
<span class="k">end</span></code></pre></figure>

<p>The base class implementation does nothing except return the data it was given. The only exception to this is when handling an empty string. If the allow_empty_data flag is false or if it nil and the Protocol is the last in the chain, then the base implementation will return :STOP data to indicate that it is time to call the Interface read_interface() method to get more data. Blank strings are used to signal Protocols that they have an opportunity to return a cached packet.</p>

<h3 id="read_packet">
<a id="read_packet" class="anchor" href="#read_packet" aria-hidden="true"><span class="octicon octicon-link"></span></a>read_packet</h3>

<p>The read_packet method is used to analyze and potentially modify a COSMOS packet before it is returned by the Interface. It takes one parameter as the current state of the packet to be analyzed. It can return either a COSMOS packet, :STOP, or :DISCONNECT. If it returns a COSMOS packet, then it believes that the packet is valid, should be returned, and is ready for processing by any following Protocols. If :STOP is returned then the Protocol believes the packet should be silently dropped. If :DISCONNECT is returned then the Protocol believes the Interface should be disconnected (and typically automatically reconnected).</p>

<p>Base Class Implementation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">read_packet</span><span class="p">(</span><span class="n">packet</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">packet</span>
<span class="k">end</span></code></pre></figure>

<p>The base class always just returns the packet given.</p>

<h3 id="write_packet">
<a id="write_packet" class="anchor" href="#write_packet" aria-hidden="true"><span class="octicon octicon-link"></span></a>write_packet</h3>

<p>The write_packet method is used to analyze and potentially modify a COSMOS packet before it is output by the Interface. It takes one parameter as the current state of the packet to be analyzed. It can return either a COSMOS packet, :STOP, or :DISCONNECT. If it returns a COSMOS packet, then it believes that the packet is valid, should be written out the Interface, and is ready for processing by any following Protocols. If :STOP is returned then the Protocol believes the packet should be silently dropped. If :DISCONNECT is returned then the Protocol believes the Interface should be disconnected (and typically automatically reconnected).</p>

<p>Base Class Implementation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">write_packet</span><span class="p">(</span><span class="n">packet</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">packet</span>
<span class="k">end</span></code></pre></figure>

<p>The base class always just returns the packet given.</p>

<h3 id="write_data">
<a id="write_data" class="anchor" href="#write_data" aria-hidden="true"><span class="octicon octicon-link"></span></a>write_data</h3>

<p>The write_data method is used to analyze and potentially modify data before it is written out by the Interface. It takes one parameter as the current state of the data to be analyzed and sent. It can return either a Ruby String of data, :STOP, or :DISCONNECT. If it returns a Ruby string of data, then it believes that the data is valid, should be written out the Interface, and is ready for processing by any following Protocols. If :STOP is returned then the Protocol believes the data should be silently dropped. If :DISCONNECT is returned then the Protocol believes the Interface should be disconnected (and typically automatically reconnected).</p>

<p>Base Class Implementation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">data</span>
<span class="k">end</span></code></pre></figure>

<p>The base class always just returns the data given.</p>

<h3 id="post_write_interface">
<a id="post_write_interface" class="anchor" href="#post_write_interface" aria-hidden="true"><span class="octicon octicon-link"></span></a>post_write_interface</h3>

<p>The post_write_interface method is called after data has been written out the Interface. The typical use of this method is to provide a hook to implement command/response type interfaces where a response is always immediately expected in response to a command. It takes two parameters, the packet after all modifications by write_packet() and the data that was actually written out the Interface. It can return either the same pair of packet/data, :STOP, or :DISCONNECT. If it returns a packet/data pair then they are passed on to any other Protocols. If :STOP is returned then the Interface write() call completes and no further Protocols post_write_interface() methods are called. If :DISCONNECT is returned then the Protocol believes the Interface should be disconnected (and typically automatically reconnected). Note that only the first parameter “packet”, is checked to be :STOP, or :DISCONNECT on the return.</p>

<p>Base Class Implementation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">post_write_interface</span><span class="p">(</span><span class="n">packet</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">packet</span><span class="p">,</span> <span class="n">data</span>
<span class="k">end</span></code></pre></figure>

<p>The base class always just returns the packet/data given.</p>

<h2 id="examples">
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h2>

<p>Please see the included COSMOS protocol code for examples of the above methods in action.</p>

<p><a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/protocol.rb">lib/cosmos/interfaces/protocols/protocol.rb</a>
<a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/burst_protocol.rb">lib/cosmos/interfaces/protocols/burst_protocol.rb</a>
<a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/fixed_protocol.rb">lib/cosmos/interfaces/protocols/fixed_protocol.rb</a>
<a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/length_protocol.rb">lib/cosmos/interfaces/protocols/length_protocol.rb</a>
<a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/preidentified_protocol.rb">lib/cosmos/interfaces/protocols/preidentified_protocol.rb</a>
<a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/terminated_protocol.rb">lib/cosmos/interfaces/protocols/terminated_protocol.rb</a>
<a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/template_protocol.rb">lib/cosmos/interfaces/protocols/template_protocol.rb</a>
<a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/override_protocol.rb">lib/cosmos/interfaces/protocols/override_protocol.rb</a>
<a href="https://github.com/BallAerospace/COSMOS/blob/master/lib/cosmos/interfaces/protocols/crc_protocol.rb">lib/cosmos/interfaces/protocols/crc_protocol.rb</a></p>

          





  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  

  
  
    <div class="top-section-nav">
      <div class="left align-right">
          
            
            
            <a href="/docs/interfaces/" class="prev">Back</a>
          
      </div>
      <div class="right align-left">
          
            
            
            <a href="/docs/environment/" class="next">Next</a>
          
      </div>
    </div>
    <div class="clear"></div>
    

        </article>
      </div>

      <div class="unit one-fifth hide-on-mobiles">
  <aside>
    
    <h4>Getting Started</h4>
    

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/home/">Welcome</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/installation/">Installation</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/upgrading/">Upgrading and the Gemfile</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/structure/">Directory structure</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/gettingstarted/">Getting Started</a></li>
      


</ul>

    
    <h4>System Configuration</h4>
    

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/system/">System Configuration</a></li>
      


  

  

  
    
  
    
      <li class=""><a href="/docs/command/">Command Configuration</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/telemetry/">Telemetry Configuration</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/interfaces/">Interface Configuration</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class="current"><a href="/docs/protocols/">Protocol Configuration</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/environment/">Environment Variables</a></li>
      


</ul>

    
    <h4>Tool Configuration</h4>
    

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/launcher/">Launcher</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/data_viewer/">Data Viewer</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/handbook_creator/">Handbook Creator</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/limits_monitor/">Limits Monitor</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/script_runner/">Script Runner</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/table_manager/">Table Manager</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/test_runner/">Test Runner</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/tlm_extractor/">Telemetry Extractor</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/tlm_viewer/">Telemetry Viewer</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/screens/">Telemetry Screens</a></li>
      


</ul>

    
    <h4>User's Guides</h4>
    

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/scripting/">Scripting Guide</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/gemtargets/">Gem Based Targets and Tools</a></li>
      


</ul>

    
    <h4>Tips</h4>
    

<ul>

  

  

  
    
      <li class=""><a href="/docs/chaining/">Chaining CmdTlmServers</a></li>
      


</ul>

    
    <h4>Development</h4>
    

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/system_class/">System Class</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/packet_class/">Packet Class</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/json_api/">JSON API</a></li>
      


</ul>

    
    <h4>Meta</h4>
    

<ul>

  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/requirements/">Requirements and Design</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/xtce/">XTCE Support</a></li>
      


  

  

  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/contributing/">Contributing</a></li>
      


  

  

  
    
  
    
  
    
      <li class=""><a href="/docs/contact/">Contact Us</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/history/">Release History</a></li>
      


  

  

  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <li class=""><a href="/docs/papers/">Papers</a></li>
      


</ul>

    
  </aside>
</div>


      <div class="clear"></div>

    </div>
  </section>


  <script>
  (function() {
    var cx = '001663949569052626382:-enhin1layy';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<footer role="contentinfo">
  <div class="grid wider">
    <div class="unit one-third center-on-mobiles">
      <p>The contents of this website are &copy;&nbsp;2018 <a href="http://www.ballaerospace.com/" target="_blank">Ball Aerospace</a> under the terms of the <a href="https://github.com/BallAerospace/COSMOS/blob/master/LICENSE.txt" target="_blank">GPLv3&nbsp;License</a>.</p>
      <p>Site design derived from the <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> project documentation which is licensed under the terms of the <a href="https://github.com/jekyll/jekyll/blob/master/LICENSE" target="_blank">MIT License</a>.</p>
    </div>
    <div class="unit two-thirds align-right center-on-mobiles">
      <p>
        <gcse:search></gcse:search>
        Proudly hosted by
        <a href="https://github.com" target="_blank">
          <img src="/img/footer-logo.png" width="100" height="30" alt="GitHub Social coding">
        </a>
      </p>
    </div>
  </div>
</footer>

  <script>
  var anchorForId = function (id) {
    var anchor = document.createElement("a");
    anchor.className = "header-link";
    anchor.href      = "#" + id;
    anchor.innerHTML = "<span class=\"sr-only\">Permalink</span><i class=\"fa fa-link\"></i>";
    anchor.title = "Permalink";
    return anchor;
  };

  var linkifyAnchors = function (level, containingElement) {
    var headers = containingElement.getElementsByTagName("h" + level);
    for (var h = 0; h < headers.length; h++) {
      var header = headers[h];

      if (typeof header.id !== "undefined" && header.id !== "") {
        header.appendChild(anchorForId(header.id));
      }
    }
  };

  document.onreadystatechange = function () {
    if (this.readyState === "complete") {
      var contentBlock = document.getElementsByClassName("docs")[0] || document.getElementsByClassName("news")[0];
      if (!contentBlock) {
        return;
      }
      for (var level = 1; level <= 6; level++) {
        linkifyAnchors(level, contentBlock);
      }
    }
  };
</script>

  
  <!-- Google Analytics (http://google.com/analytics) -->
  <script>
    !function(j,e,k,y,l,L){j.GoogleAnalyticsObject=y,j[y]||(j[y]=function(){
    (j[y].q=j[y].q||[]).push(arguments)}),j[y].l=+new Date,l=e.createElement(k),
    L=e.getElementsByTagName(k)[0],l.src='//www.google-analytics.com/analytics.js',
    L.parentNode.insertBefore(l,L)}(window,document,'script','ga');

    ga('create', 'UA-60103689-1', 'cosmosrb.com');
    ga('send', 'pageview');

  </script>



</body>
</html>
